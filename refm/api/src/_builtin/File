= class File < IO
ファイルアクセスのためのクラスです。
通常 [[m:Kernel#open]] または [[m:File.open]] を使って生成します。

#@if (version >= "1.8.0")
((<ruby 1.8 feature>)): File::Constants は、[[c:IO]] でインクルードさ
れるようになりました。
#@else
include File::Constant
#@end

Fileクラスがインクルードしている [[c:File::Constants]] は File クラスに関係する定数を
格納したモジュールです。
また [[c:File::Stat]] は stat 構造体([[man:stat(2)]]参照)を表すクラスです。

== Class Methods

--- atime(filename)    -> Time
#@todo
最終アクセス時刻を返します。

@param filename ファイル名を表す文字列か IO オブジェクトを指定します。

@raise Errno::EXXX ファイルの時刻の取得に失敗した場合に発生します。

--- ctime(filename)    -> Time
#@todo
状態が最後に変更された時刻を返します。
状態の変更とは chmod などによるものです。

@param filename ファイル名を表す文字列か IO オブジェクトを指定します。

@raise Errno::EXXX ファイルの時刻の取得に失敗した場合に発生します。

--- mtime(filename)    -> Time
#@todo
最終更新時刻を返します。

@param filename ファイル名を表す文字列か IO オブジェクトを指定します。

@raise Errno::EXXX ファイルの時刻の取得に失敗した場合に発生します。

--- basename(filename, suffix = "")     -> String
#@todo

filename の一番後ろのスラッシュに続く要素を返します。もし、
引数 suffix が与えられて、かつそれが filename の末尾に
一致するなら、それを取り除いたものを返します。

例:

  p File.basename("ruby/ruby.c")        #=> "ruby.c"
  p File.basename("ruby/ruby.c", ".c")  #=> "ruby"
  p File.basename("ruby/ruby.c", ".*")  #=> "ruby"
  p File.basename("ruby/ruby.exe", ".*")  #=> "ruby"

[[m:File.dirname]], [[m:File.extname]] も参照。

#@since 1.8.0
File.basename の動作は [[url:http://www.unix-systems.org/version3/online.html]] に従います。
  p File.basename("foo/bar/")      # => "bar"
#@end

@param filename ファイル名を表す文字列を指定します。

--- chmod(mode, *filename)    -> Integer
#@todo

ファイルのモードを mode に変更します。モードを変更したファイ
ルの数を返します。

@param filename ファイル名を表す文字列を指定します。

@param mode [[man:chmod(2)]] と同様に整数で指定します。

@raise Errno::EXXX モードの変更に失敗した場合に発生します。

--- lchmod(mode, *filename)    -> Integer
#@todo

[[m:File.chmod]] と同様ですが、シンボリックリンクに関してリンクそのものの
モードを変更します。

@param filename ファイル名を表す文字列を指定します。

@param mode [[man:chmod(2)]] と同様に整数で指定します。

@raise NotImplementedError [[man:lchmod(2)]] を実装していないシステムでこのメソッドを呼び出すと発生します。

@raise Errno::EXXX モードの変更に失敗した場合に発生します。

--- chown(owner, group, *filename)    -> Integer
#@todo

ファイルのオーナーとグループを変更します。スーパーユーザだけがファ
イルのオーナーとグループを変更できます。変更を行ったファイルの数を
返します。

@param filename ファイル名を表す文字列を指定します。

@param owner [[man:chown(2)]] と同様に数値で指定します。nil または -1 を指定することで、オーナーを現在のままにすることができます。

@param group [[man:chown(2)]] と同様に数値で指定します。nil または -1 を指定することで、グループを現在のままにすることができます。

@raise Errno::EXXX 変更に失敗した場合に発生します。

--- lchown(owner, group, *filename)    -> Integer
#@todo
[[m:File#chown]] と同様ですが、
シンボリックリンクに関してリンクそのもののオーナー、
グループを変更します。

@param filename ファイル名を表す文字列を指定します。

@param owner [[man:chown(2)]] と同様に数値で指定します。nil または -1 を指定することで、オーナーを現在のままにすることができます。

@param group [[man:chown(2)]] と同様に数値で指定します。nil または -1 を指定することで、グループを現在のままにすることができます。

@raise NotImplementedError [[man:lchown(2)]] を実装していないシステムでこのメソッドを呼び出すと発生します。

--- delete(*filename)    -> Integer
--- unlink(*filename)    -> Integer
#@todo

ファイルを削除します。削除したファイルの数を返します。
削除に失敗した場合は例外 [[c:Errno::EXXX]] が発生します。

このメソッドは通常ファイルの削除用で、ディレクトリの削除には
[[m:Dir.rmdir]] を使います。

@param filename ファイル名を表す文字列を指定します。

--- dirname(filename)    -> String
#@todo

filename の一番後ろのスラッシュより前を文
字列として返します。スラッシュを含まないファイル名に対しては
"."(カレントディレクトリ)を返します。

例:
    p File.dirname("dir/file.ext")    # => "dir"
    p File.dirname("file.ext")        # => "."

[[m:File.basename]], [[m:File.extname]] も参照。

#@if (version >= "1.8.0")
File.dirname の動作は [[url:http://www.unix-systems.org/version3/online.html]] に従います。
    p File.dirname("foo/bar/")      # => "foo"
    p File.dirname("foo//bar")      # => "foo"
#@end

@param filename ファイル名を表す文字列を指定します。

--- expand_path(path, default_dir = '.')    -> String
#@todo

path を絶対パスに展開した文字列を返します。
path が相対パスであれば default_dir を基準にします。

先頭の ~ はホームディレクトリ(環境変数 HOME が使われます)に、
~USER はそのユーザのホームディレクトリに展開されます。

  p File.expand_path("..")         #=> "/home/matz/work"
  p File.expand_path("..", "/tmp") #=> "/"
  p File.expand_path("~")          #=> "/home/matz"
  p File.expand_path("~foo")       #=> "/home/foo"

@param path パスを表す文字列を指定します。

@param default_dir パスを表す文字列を指定します。

--- extname(filename)    -> String
#@todo

ファイル名 filename の拡張子部分(最後の "." に続く文字列)を
返します。ディレクトリ名に含まれる "." や、ファイル名先頭の "."
は拡張子の一部としては見なされません。filename に拡張子が含
まれない場合は空文字列を返します。

  p File.extname("foo/foo.txt")     # => ".txt"
  p File.extname("foo/foo.tar.gz")  # => ".gz"
  p File.extname("foo/bar")         # => ""
  p File.extname("foo/.bar")        # => ""
  p File.extname("foo.txt/bar")     # => ""
  p File.extname(".foo")            # => ""

[[m:File.basename]], [[m:File.dirname]] も参照。

@param filename ファイル名を表す文字列を指定します。

--- fnmatch(pattern, path, flags = 0)     -> boolean 
--- fnmatch?(pattern, path, flags = 0)    -> boolean
#@todo

ファイル名のパターンマッチを行います([[man:fnmatch(3)]])。
path が pattern にマッチすれば真を返します。

pattern にはワイルドカードとして `*', `?', `[]' が使用できま
す([[m:Dir.glob]] とは違って `{}' や `**/' は使用できません)。

    %w(foo foobar bar).each {|f|
      p File.fnmatch("foo*", f)
    }
    # => true
         true
         false

flags に以下の定数([[c:File::Constants]] モジュールで定義さ
れています)を論理和で指定することでパターンマッチの動作を変更する
ことができます。flags のデフォルト値は0(フラグ指定なし)です。

: FNM_NOESCAPE
 エスケープ文字 `\' を普通の文字とみなします。
//emlist{
  # デフォルトでは \ を伴う任意の文字はその文字にマッチしますが、
  # このフラグをつけると、\ が普通の文字として扱われます。
  p File.fnmatch('\a', 'a')                       # => true
  p File.fnmatch('\a', '\a', File::FNM_NOESCAPE)  # => true

  # 前者で * は、エスケープされているので "*" そのものにマッチ
  # します。
  p File.fnmatch('\*', 'a')                       # => false
  p File.fnmatch('\*', '\a', File::FNM_NOESCAPE)  # => true

  # 単体の \ は、このフラグの有無に関わらず \ にマッチします。
  # (シングルクォート文字列中では \\ は、\ であることに注意)
  p File.fnmatch('\\', '\\')                      # => true
  p File.fnmatch('\\', '\\', File::FNM_NOESCAPE)  # => true
//}
: FNM_PATHNAME
 ワイルドカード `*', `?', `[]' が `/' にマッチしなくなります。
 シェルのパターンマッチにはこのフラグが使用されています。
//emlist{
  p File.fnmatch('*', '/', File::FNM_PATHNAME)   # => false
  p File.fnmatch('?', '/', File::FNM_PATHNAME)   # => false
  p File.fnmatch('[/]', '/', File::FNM_PATHNAME) # => false
//}
: FNM_CASEFOLD
 アルファベットの大小文字を区別せずにパターンマッチを行います。
//emlist{
  p File.fnmatch('A', 'a', File::FNM_CASEFOLD)   # => true
//}
: FNM_DOTMATCH
 ワイルドカード `*', `?', `[]' が先頭の `.' にマッチするようになります。
//emlist{
  p File.fnmatch('*', '.', File::FNM_DOTMATCH)           # => true
  p File.fnmatch('?', '.', File::FNM_DOTMATCH)           # => true
  p File.fnmatch('[.]', '.', File::FNM_DOTMATCH)         # => true
  p File.fnmatch('foo/*', 'foo/.', File::FNM_DOTMATCH)   # => true
//}

--- ftype(filename)    -> String
#@todo

ファイルのタイプを表す文字列を返します。文字列は以下のうちのいずれ
かです。File.lstat(filename).ftype と同じで
す(シンボリックリンクに対して "link" を返します)。

  "file"
  "directory"
  "characterSpecial"
  "blockSpecial"
  "fifo"
  "link"
  "socket"

  "unknown"

--- join(*item)    -> String
#@todo

File::SEPARATORを間に入れて文字列を連結します。

  [item, item, ...].join(File::SEPARATOR)

と同じです。([[unknown:DOSISH 対応]]で環境依存になる予定です。)

--- link(old, new)    -> 0
#@todo

old を指す new という名前のハードリンクを
生成します。old はすでに存在している必要があります。

ハードリンクに成功した場合は 0 を返します。失敗した場合は例外
[[c:Errno::EXXX]] が発生します。

--- new(path, mode = "r", perm = 0666)                -> File 
--- open(path, mode = "r", perm = 0666)               -> File 
--- open(path, mode = "r", perm = 0666) {|file| ... } -> object
#@todo

pathで指定されるファイルをオープンし、ファイルオブジェクトを
返します。ファイルのオープンに失敗した場合は例外 [[c:Errno::EXXX]] が発生します。

引数 mode, perm については 組み込み関数
[[m:Kernel#open]] と同じです。

open() はブロックを指定することができます。
ブロックを指定して呼び出した場合は、ファイルオブジェクトを
与えられてブロックが実行されます。ブロックの実行が終了すると、
ファイルは自動的にクローズされます。

ブロックが指定されたときのこのメソッドの戻り値はブロックの実行結果
です。

#@since 1.9.0
--- path(filename)
#@todo
#@end

--- readlink(path)    -> String
#@todo

シンボリックリンクのリンク先を文字列で返します。リンクの読み取りに
失敗した場合は例外 [[c:Errno::EXXX]] が発生します。

--- rename(from, to)    -> 0
#@todo

ファイルの名前を変更します。ディレクトリが異なる場合には移動も行い
ます。[[man:rename(2)]] を参照してください。移動先のファ
イルが存在する時には上書きされます。

ファイルの移動に成功した場合 0 を返します。失敗した場合は例外
[[c:Errno::EXXX]] が発生します。

--- split(pathname)    -> [String]
#@todo

pathname を dirname とbasename に分割して、2 要
素の配列を返します。

  [File.dirname(pathname), File.basename(pathname)]

と同じです。

--- stat(filename)    -> File::Stat
#@todo
filename の情報を含む [[c:File::Stat]] オブジェクトを生成し
て返します。

[[m:IO#stat]], [[m:File#lstat]] も参照してください。

@raise Errno::EXXX 情報の取得に失敗した場合に発生します。

--- lstat(filename)   -> File::Stat
#@todo
[[m:File.stat]]と同様ですが、シンボリックリンクに関してリンクそのものの
情報を返します。[[man:lstat(2)]] を実装していないシステムでは、File.stat と同じです。

[[m:IO#stat]], [[m:File#lstat]] も参照してください。

--- symlink(old, new)    -> 0
#@todo

old への new という名前のシンボリックリンクを生成しま
す。

シンボリックリンクの作成に成功すれば 0 を返します。失敗した場合は
例外 [[c:Errno::EXXX]] が発生します。

--- truncate(path, length)    -> 0
#@todo

path で指定されたファイルのサイズを最大 length バイト
にします。

サイズの変更に成功すれば 0 を返します。失敗した場合は例外
[[c:Errno::EXXX]] が発生します。

--- umask           -> Integer
--- umask(umask)    -> Integer
#@todo

umask を変更します。変更前の umask の値を返します。umask を
省略すると変更を行わないで、現在の umask の値を返します。

--- utime(atime, mtime, *filename)    -> Integer
#@todo

ファイルの最終アクセス時刻と更新時刻を変更します。変更したファイル
の数を返します。変更に失敗した場合は例外 [[c:Errno::EXXX]] が発生
します。

先頭の二つの引数は時刻を指定する数値または [[c:Time]] クラスのイン
スタンスでなければなりません。

--- blockdev?(path)    -> boolean
#@todo

[[m:FileTest.#blockdev?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- chardev?(path)    -> boolean
#@todo

[[m:FileTest.#chardev?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- directory?(path)    -> boolean
#@todo

[[m:FileTest.#directory?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- executable?(path)    -> boolean
#@todo

[[m:FileTest.#executable?]] と同じです。

@param path パスを表す文字列を指定します。

--- executable_real?(path)    -> boolean
#@todo

[[m:FileTest.#executable_real?]] と同じです。

@param path パスを表す文字列を指定します。

--- exist?(path)    -> boolean
#@todo

[[m:FileTest.#exist?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- exists?(path)    -> boolean
#@todo
このメソッドはobsoleteです。

[[m:FileTest.#exist?]] と同じです。
[[m:File#exist?]]を使って下さい。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- file?(path)    -> boolean
#@todo

[[m:FileTest.#file?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- grpowned?(path)    -> boolean
#@todo

[[m:FileTest.#grpowned?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- owned?(path)    -> boolean
#@todo

[[m:FileTest.#owned?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- identical?(filename1, filename2)    -> boolean
#@todo

[[m:FileTest.#identical?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- pipe?(path)    -> boolean
#@todo

[[m:FileTest.#pipe?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- readable?(path)    -> boolean
#@todo

[[m:FileTest.#readable?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- readable_real?(path)    -> boolean
#@todo

[[m:FileTest.#readable_real?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- setgid?(path)    -> boolean
#@todo

[[m:FileTest.#setgid?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- setuid?(path)    -> boolean
#@todo

[[m:FileTest.#setuid?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- size(path)    -> boolean
#@todo

[[m:FileTest.#size]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- size?(path)    -> boolean
#@todo

[[m:FileTest.#size?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- socket?(path)    -> boolean
#@todo

[[m:FileTest.#socket?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- sticky?(path)    -> boolean
#@todo

[[m:FileTest.#sticky?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- symlink?(path)    -> boolean
#@todo

[[m:FileTest.#symlink?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

--- writable?(path)    -> boolean
#@todo

[[m:FileTest.#writable?]] と同じです。

@param path パスを表す文字列を指定します。

--- writable_real?(path)    -> boolean
#@todo

[[m:FileTest.#writable_real?]] と同じです。

@param path パスを表す文字列を指定します。

--- zero?(path)    -> boolean
#@todo

[[m:FileTest.#zero?]] と同じです。

@param path パスを表す文字列か IO オブジェクトを指定します。

#@since 1.9.0
--- world_readable?(path)    -> boolean
#@todo
If _file_name_ is readable by others, returns an integer
representing the file permission bits of _file_name_. Returns +nil+
otherwise. The meaning of the bits is platform dependent; on Unix
systems, see +stat(2)+.

        File.world_readable?("/etc/passwd")           # => 420
        m = File.world_readable?("/etc/passwd")
        sprintf("%o", m)                              # => "644"

--- world_writable?(path)    -> boolean
#@todo
If _file_name_ is writable by others, returns an integer
representing the file permission bits of _file_name_. Returns +nil+
otherwise. The meaning of the bits is platform dependent; on Unix
systems, see +stat(2)+.

        File.world_writable?("/tmp")                  #=> 511
        m = File.world_writable?("/tmp")
        sprintf("%o", m)                              #=> "777"
#@end

== Instance Methods

--- atime    -> Time
#@todo
最終アクセス時刻を返します。

@raise Errno::EXXX ファイルの時刻の取得に失敗した場合に発生します。

--- ctime    -> Time
#@todo
状態が最後に変更された時刻を返します。状態の変更とは chmod などによるものです。

@raise Errno::EXXX ファイルの時刻の取得に失敗した場合に発生します。

--- mtime    -> Time
#@todo

最終更新時刻を返します。

@raise Errno::EXXX ファイルの時刻の取得に失敗した場合に発生します。

--- chmod(mode)    -> 0
#@todo

ファイルのモードを mode に変更します。モードの変更に成功した
場合は 0 を返します。失敗した場合は例外 [[c:Errno::EXXX]] が発生し
ます。

mode は [[man:chmod(2)]] と同様に数値で指定します。

--- chown(owner, group)    -> 0
#@todo

ファイルのオーナーとグループを変更します。スーパーユーザだけがファ
イルのオーナーとグループを変更できます。所有者の変更に成功した場合
は 0 を返します。変更に失敗した場合は例外 [[c:Errno::EXXX]] が発生
します。

owner と group は、[[man:chown(2)]] と同様に
数値で指定します。
nil または -1 を指定することでオーナーやグループを現在
のままにすることができます。

--- flock(operation)    -> 0 | false
#@todo

ファイルをロックします。ロックに成功した場合は 0 を返します。失敗
した場合は例外 [[c:Errno::EXXX]] が発生します。File::LOCK_NB が指
定されていて、ブロックされそうな場合には false を返します。
有効な operation は以下の通りです。

: LOCK_SH
 共有ロック。複数のプロセスが同時にロックを共有できます。
 システムによってはロック対象のファイルは読み込みモード
 ("r", "r+" など)でオープンされている必要があります。そのよ
 うなシステムでは読み込み可能でないファイルに対するロックは例外
 [[c:Errno::EXXX]] が発生するかもしれません。
: LOCK_EX
 排他ロック。同時にはただひとつのプロセスだけがロックを保持できます。
 システムによってはロック対象のファイルは書き込みモード
 ("w", "r+" など)でオープンされている必要があります。そのよ
 うなシステムでは書き込み可能でないファイルに対するロックは例外
 [[c:Errno::EXXX]] が発生するかもしれません。
: LOCK_UN
 アンロック。
 この明示的なアンロック以外に、Rubyインタプリタの終了
 (プロセスの終了)によっても自動的にロック状態は解除されます。
: LOCK_NB
 ノンブロックモード。
 File::LOCK_SH | File::LOCK_NB のように他の指定と or することで指
 定します。この指定がない場合、ブロックされる条件での flock
 の呼び出しはロックが解除されるまでブロックされます。

File::LOCK_NB の指定がある場合、ブロックされる条件での
flock は false を返します。

「ブロックされる条件」とは
  * 他のプロセスが排他ロックをすでに行っている場合にロックを行う
  * 他のプロセスがロックしている状態で排他ロックを行う
の場合です

以上の定数は [[c:File::Constants]] モジュールで定義されています。

例:

    f = File.open("/tmp/foo", "w")

    f.flock(File::LOCK_EX)
    puts "locked by process1"

    fork {
      f = File.open("/tmp/foo", "r")
      f.flock(File::LOCK_SH)
      puts "locked by process2"
      sleep 5
      puts "unlocked by process2"
    }

    sleep 5

    f.flock(File::LOCK_UN)
    puts "unlocked by process1"
    sleep 1 # <- 子プロセスが確実に先にロックするための sleep
    f.flock(File::LOCK_EX)
    puts "re-locked by process1"

    => locked by process1
       unlocked by process1
       locked by process2
       unlocked by process2
       re-locked by process1

--- path    -> String
#@todo

オープン時に使用したパスを文字列で返します。

--- lstat    -> File::Stat
#@todo

ファイルの状態を含む [[c:File::Stat]] オブジェクトを生成して返しま
す。情報の取得に失敗した場合は例外 [[c:Errno::EXXX]] が発生します。

lstat は、シンボリックリンクに関してリンクそのものの
情報を返します。
[[man:lstat(2)]] を実装していないシステムでは、
[[m:IO#stat]]と同じです。

[[m:IO#stat]], [[m:File.stat]], [[m:File.lstat]] も参照してください。

--- truncate(length)    -> 0
#@todo

ファイルのサイズを最大 length バイトにします。ファイルが書き
込みモードでオープンされてなければ例外 [[c:IOError]] が発生します。

サイズの変更に成功すれば 0 を返します。失敗した場合は例外
[[c:Errno::EXXX]] が発生します。

== Constants

--- ALT_SEPARATOR
#@todo

システムのファイルパスのセパレータが SEPARATOR と異なる場合
に設定されます。MS-DOS などでは "\" です。UNIX や
[[c:Cygwin]] などでは nil です。

--- PATH_SEPARATOR
#@todo

PATH 環境変数の要素のセパレータです。UNIX では ":" MS-DOS な
どでは ";" です。

--- SEPARATOR
--- Separator
#@todo

ファイルパスのセパレータです。ファイルを扱うメソッドにパス名を渡す
場合などスクリプト内のパス名は環境によらずこのセパレータで統一され
ます。値は "/" です。

