
= class TkVariable < Object

extend TkCore
include Tk
include Comparable

Tclの変数をアクセスするためのクラスです。
((-Tclの配列としての振る舞いは仕様が不安定のようです-))

  require "tk"
  p TkVariable.new(0).value                     # => "0"
  p TkVariable.new(1.2).value                   # => "1.2"
  p TkVariable.new(["a", "b"]).value            # => {"0"=>"a", "1"=>"b"}
  p TkVariable.new(1=>"a", 2=>"b").value        # => {"1"=>"a", "2"=>"b"}


== Class Methods

--- callback(args)

[[m:TkVariable#trace]]により登録されたProcオブジェクトを実行します。
args は、 [TkVariableのインスタンス, "キー", "操作"]
である配列です。

--- new(val="")

値がvalであるTkVariableオブジェクトを生成します。valが
[[c:Array]] または [[c:Hash]] のオブジェクトである場合、生成されたインス
タンスは Tclの配列として振る舞います。

--- new_hash(val = {})

== Instance Methods

--- wait

値が変化するまで待ちます。

--- value

値を返します。selfがTclの配列ならば(Tclの配列は連想配列な
ので) [[c:Hash]]として返します。それ以外では常に文字列を返します。

--- value=(val)

値をvalに設定します。

#@since 1.8.3
--- set_value(val)

値を val に設定し、self を返します。

--- set_value_type(val)
--- value_type=

#@end

--- [](index)

index番目の値を返します。
selfはTclの配列でなければなりません。

--- []=(index, val)

index番目の要素をvalにします。
selfはTclの配列でなければなりません。

--- to_i

値を数値([[c:Fixnum]])として返します。(現状のTkVariableは、
Bignumを値にすることはできません)

#@since 1.8.3
--- element_to_i(*idxs)

#@end

--- to_f

値を数値([[c:Float]])として返します。


#@since 1.8.3
--- element_to_f(*idxs)

#@end

--- to_s

値を文字列([[c:String]])として返します。

--- to_a

値を配列([[c:Array]])として返します。

--- ==(other)

値がotherと同じである場合に真です。otherは、
TkVariable, String, Integer, Float, Arrayのいずれかです。

--- <=>(other)

--- &(other)

--- |(other)

--- +(other)

--- -(other)

--- *(other)

--- /(other)

--- %(other)

--- **(other)

--- =~(other)

--- unset(elem=nil)
--- remove(elem=nil)

値がTcl配列であるとき、elemの値を削除します。

--- id

--- is_hash?

--- is_scalar?

--- keys

--- ref(*idxs)

#@since 1.8.3
--- exist?(*elems)

#@end

--- trace_callback(elem, op)

[[m:TkVariable#trace]]により登録されたProcオブジェクトを引数にself,
elem, opを指定して実行します。

  require "tk"

  var = TkVariable.new(0)

  var.trace "rwu", proc {|arg| puts "callback called with #{arg.inspect}"}
  var.trace_callback([], "r")

--- trace(opts, cmd)

optsは、"r", "w", "u" のいずれか、またはこれらの組み合わせで、それぞれ
変数が参照、設定、削除 されたときに[[c:Proc]]オブジェクト cmd を
呼び出します。2回目以降の呼び出しでは、opts が以前の設定と異なれ
ばcmdを再設定します。

cmdは、引数に、self、空配列、"操作" を渡されて呼ばれ
ます。"配列のキー" は、変数が配列の場合以外は空文字列です。"操作"は、
"r","w","u" のいずれかです。

  require "tk"
  
  var = TkVariable.new(0)
  
  var.trace "rwu", proc {|arg| puts "callback called with #{arg.inspect}"}
  
  p var.value
  p var.value = 1
  p var.unset
  
  =>callback called with [<TkVariable: v00000>, [], "r"]
    "0"
    callback called with [<TkVariable: v00000>, [], "w"]
    "1"
    callback called with [<TkVariable: v00000>, [], "u"]
    ""

--- trace_element(elem, opts, cmd)

--- trace_vinfo

#@if (version <= "1.8.2")
--- trace_vinfo_for_element(elem)

#@end

--- trace_vdelete(opts, cmd)

[[m:TkVariable#trace]] で設定したcmdを削除します。opts が TkVariable#trace で
設定したときと一致しなければ何もしません。

--- trace_vdelete_for_element(elem, opts, cmd)

--- clear

--- coerce(other)

#@since 1.8.3
--- size

--- lappend(*elems)

--- element_lappend(idxs, *elems)

--- lindex(idx)
--- lget(idx)

--- element_lindex(elem_idxs, idx)
--- element_lget(elem_idxs, idx)

--- lget_i(idx)

--- element_lget_i(elem_idxs, idx)

--- lget_f(idx)

--- element_lget_f(elem_idxs, idx)

--- lset(idx, val)

--- element_lset(elem_idxs, idx, val)

#@end

--- bool

--- bool=
--- set_bool

--- list

--- list=

#@since 1.8.3
--- set_list(val)

--- list_element(*idxs)
--- element_to_a(*idxs)

--- list_type=
--- set_list_type(val)

--- set_list_element_type(idxs, val)

#@end

--- numeric

--- numeric=

#@since 1.8.3
--- set_numeric(val)

--- numeric_element(*idxs)

--- set_numeric_element(idxs, val)

--- set_numeric_type(val)
--- numeric_type=

--- set_numeric_element_type(idxs, val)

#@end


#@since 1.8.3
--- bool_element

--- set_bool_element

--- bool_type=
--- set_bool_type(val)

--- set_bool_element_type(idxs, val)

--- numlist

--- numlist_element(*idxs)

--- set_numlist(val)
--- numlist=

--- set_numlist_type(val)
--- numlist_type=

--- set_numlist_element_type(idxs, val)

--- set_list_element(idxs, val)
--- set_numlist_element(idxs, val)

--- procedure

--- set_procedure(cmd)
--- procedure=

--- procedure_element(*idxs)

--- set_procedure_element(idxs, cmd)

--- procedure_type=
--- set_procedure_type(cmd)

--- set_procedure_element_type(idxs, cmd)

--- string

--- string=
--- set_string(val)

--- element_to_s(*idxs)
--- string_element(*idxs)

--- set_string_element(idxs, val)

--- string_type=
--- set_string_type(val)

--- set_string_element_type(idxs, val)

--- set_element_value(idxs, val)

--- set_element_value_type(idxs, val)

#@end

--- default_value(val = nil)
--- default_value(val = nil) { .... }

--- default_value=

#@since 1.8.3
--- set_default_value(val)

--- default_element_value_type(idxs)

--- default_value_type

--- default_value_type=
--- set_default_value_type(type)

--- set_default_element_value_type(idxs, type)

#@end

--- default_proc(cmd = Proc.new)

--- undef_default

--- eventloop_wait(check_root = false)

--- thread_wait(check_root = false)

--- tkwait(on_thread = true)

--- eventloop_tkwait

--- thread_tkwait

--- to_eval

#@since 1.8.3
--- symbol
--- to_sym

--- element_to_sym(*idxs)


--- symbol=
--- set_symbol(val)

--- symbol_element

--- symbol_type=
--- set_symbol_type(val)

--- set_symbol_element(idxs, val)

--- set_symbol_element_type(idxs, val)

#@end

--- update(hash)

#@since 1.8.3
--- variable

--- set_variable(var)
--- variable=

--- variable_element(*idxs)

--- set_variable_element(*idxs)

--- set_variable_type(var)
--- variable_type=

--- set_variable_element_type(idxs, var)

--- window

--- set_window(win)
--- window=

--- window_element(*idxs)

--- set_window_element(idxs, win)

--- set_window_type(win)
--- window_type=

--- set_window_element_type(idxs, win)

#@end

--- zero?

--- nonzero?

== Constants

--- TkVar_CB_TBL

コールバック関数を記録するハッシュです。内部で利用しています。

--- Tk_VARIABLE_ID

Tclレベルの変数名をインスタンスに割り当てるために内部で利用されています。

Tk_VARIABLE_IDは、配列ですが0番目の要素しか使われていません。
Rubyにおける定数が値を変更できないためです。

--- TkCommandNames

--- TkVar_ID_TBL

--- USE_TCLs_SET_VARIABLE_FUNCTIONS

= class TkVarAccess < TkVariable

Tclライブラリなどで既に定義されている変数にアクセスするためのクラスで
す。((-Tclのスコープを意識して利用しないとうまくアクセスできないと思わ
れる。また、現状Tclの配列にはアクセスすることはできない-))

  require 'tk'
  p TkCore::INTERP._eval("set tclvar 1")  # => 1
  var = TkVarAccess.new("tclvar", 2)
  p TkCore::INTERP._eval("set tclvar")    # => 2
  var.value = 3
  p TkCore::INTERP._eval("set tclvar")    # => 3

== Class Methods

--- new(name, *args)

Tcl変数 varname と生成したインスタンスを関連付けます。
val を指定すると値の設定も行います。

--- new_hash(name, *args)

