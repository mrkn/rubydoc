クラスリファレンス作業ノート
============================

作業はファイルフォーマットの変換から始めます。
組み込みライブラリ → 標準添付ライブラリの順番でやりましょう。


ファイルフォーマットの変換
--------------------------

変換作業では、ファイルごとに担当を決めて進めます。レポジトリに ASSIGN 
というファイルが作ってあります。この表の該当エントリに自分の Subversion
アカウント名を書いて、コミットした時点でファイルの担当が決まったものと
します。忙しくて作業ができなくなった場合は、また ASSIGN ファイルを書き
換えてコミットしてもらえれば結構です。

まだフォーマット変換が済んでいないファイルには *.off という拡張子がつい
てます。変換が終わったら svn mv で「.off」のない名前に移動することで作
業が完了したことを示します。例えば _builtin/Dir.rd.off の変換が済んだ
ら _builtin/Dir.rd に移動します。

フォーマットについては、まず実例を見てもらうのがよいと思います。すでに
変換されているファイル (*.rd) を真似しながらやってください。記述フォー
マットはレポジトリの FORMAT に書いてあります。

また、ツール (bitclust) の bin/bc-convert.rb を使うと、簡単な変換はす
べて済ませられます。一度これを使って変換したあと、ざっと見て残りを手で
いじるとよいでしょう。

  実行例
  % ruby -I./lib bin/bc-convert.rb String.rd.off > tmp
  % diff String.rd.off tmp

それ以外に、手で変換が必要になりそうなのは以下のところです。

  * 「= class String」などのレベル 1 ヘッダを新しい形式に変える
  * 「== Singleton Methods」「== Instance Methods」
    などのレベル 2 ヘッダを新しい形式に変える
  * 「メソッド一覧」は自動生成するので、すべて消す。
  * include と require を新しい文法に沿って書く
  * テキストがインデントしてたら全部下げる。
  * メソッドのシグネチャは Ruby の def と同じにする。
  * ハイパーリンクは文法がまだ決まってないのでいじらなくてよいです。
  * ((<ruby 1.x.x feature>)) はプリプロセッサの #@if に変換
  * 注釈 ((- ... -)) は消すか、プリプロセッサコメント #@# に変換

一通り変換が済んだら bitclust の bin/bc-list.rb でパースのテストをして
みてください。

  実行例
  % ruby -I./lib bin/bc-list.rb String.rd.off
  #<BitClust::LibraryDescription:0x00002a96076618
   @classes=[#<class String>],
   @methods=
    [#<smethod String.new>,
     #<imethod String#+>,
     #<imethod String#*>,
     #<imethod String#%>,
     #<imethod String#==,>,>,<,<=>,
     #<imethod String#<<,concat>,
     #<imethod String#=~>,

これでちゃんと全部のエントリが表示されていれば OK です。String.rd.off 
を String.rd に svn mv して作業を終えます。どうせあとでまたちゃんとチェッ
クするので、いまのところはだいたい通っていればよいことにします。とにか
く全部を変換するのが先決です。

手順のまとめ

  1. 変換するファイルを決める (仮に _builtin/Hash とする)。
  2. refm/api/ASSIGN の _builtin/Hash の行に
     自分のアカウント名を書いてコミットする。
  3. bitclust の bin/bc-convert.rb で変換してみる。
  4. diff をとったりして変な変換をしていないか確認する。
  5. エディタでざっと見て残りを潰す。
     変な文章が目についたらついでに直してもよい。
  6. bitclust の bin/bc-list.rb にかけてチェックする。
  7. 大丈夫そうならコミット。
  8. Hash.rd.off を Hash.rd に svn mv して再度コミットする。

わからないことがあったら ruby-reference-manual ML で聞いてください。ツー
ルがバグってる場合や、新しい機能が欲しいときも ML で聞いてください。


責任者へのコンタクト
--------------------

  ruby-reference-manual メーリングリスト
  ruby-reference-manual@ml.fdiary.net

  Minero Aoki
  aamine@loveruby.net
